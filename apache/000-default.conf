<VirtualHost *:80>
    ServerName shadowsocks-manager.local
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    # Flask приложение на порту 5000
    ProxyPass / http://localhost:5000/
    ProxyPassReverse / http://localhost:5000/
    
    # Настройки для WebSocket
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:5000/$1" [P,L]

    # Логирование
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Заголовки для прокси
    RequestHeader set X-Forwarded-Proto http
    RequestHeader set X-Forwarded-Port 80

    # Таймауты
    ProxyTimeout 300
</VirtualHost>

<VirtualHost *:443>
    ServerName shadowsocks-manager.local
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    # SSL конфигурация (если есть сертификаты)
    # SSLEngine on
    # SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    # SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    # Flask приложение на порту 5000
    ProxyPass / http://localhost:5000/
    ProxyPassReverse / http://localhost:5000/
    
    # Настройки для WebSocket
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:5000/$1" [P,L]

    # Логирование
    ErrorLog ${APACHE_LOG_DIR}/error-ssl.log
    CustomLog ${APACHE_LOG_DIR}/access-ssl.log combined

    # Заголовки для прокси
    RequestHeader set X-Forwarded-Proto https
    RequestHeader set X-Forwarded-Port 443

    # Таймауты
    ProxyTimeout 300
</VirtualHost>

# Конфигурация mod_wsgi (альтернативный вариант без прокси)
# <VirtualHost *:5000>
#     WSGIDaemonProcess shadowsocks python-home=/app/.venv python-path=/app/api
#     WSGIProcessGroup shadowsocks
#     WSGIScriptAlias / /app/api/wsgi.py
#     
#     <Directory /app/api>
#         Require all granted
#     </Directory>
#     
#     ErrorLog ${APACHE_LOG_DIR}/wsgi-error.log
#     CustomLog ${APACHE_LOG_DIR}/wsgi-access.log combined
# </VirtualHost>